---
import Layout from "../layouts/Layout.astro";
const pageTitle = "Collections — Itrora";
---

<Layout title={pageTitle} description="Toutes nos fragrances Itrora Parfums.">
  <!-- ===== HERO COLLECTIONS (image pleine largeur) ===== -->
  <section class="hc">
    <div class="hc__media">
      <img class="hc__bg" src="/entete-collections.png" alt="Gamme Itrora Parfums" loading="eager" fetchpriority="high" />
      <div class="hc__shade" aria-hidden="true"></div>
    </div>

    <div class="hc__inner">
      <nav class="hc__blur-nav" aria-label="Navigation secondaire">
        <a href="/">Accueil</a>
        <a href="/collections">Collections</a>
        <a href="/a-propos">A propos</a>
        <a href="/contact">Contact</a>
        <a href="/foireauxquestions">FAQ</a>
      </nav>
      <h1 class="hc__title">Les Parfums</h1>
    </div>
  </section>

  <!-- ===== TOOLBAR (compteur + tri) ===== -->
  <section class="shop">
    <div class="shop__wrap">

      <div class="shop__toolbar">
        <div class="results-count" data-first="1" data-last="3" data-total="3">AFFICHAGE DE 1–3 SUR 3 RÉSULTATS</div>

        <!-- Tri -->
        <label class="sort" aria-label="Trier les produits">
          <select id="sortSelect">
            <option value="default" selected>Tri par defaut</option>
            <option value="pop">Tri par popularite</option>
            <option value="rating">Tri par notes moyennes</option>
            <option value="date">Tri du plus recent au plus ancien</option>
            <option value="price-asc">Tri par tarif croissant</option>
            <option value="price-desc">Tri par tarif decroissant</option>
          </select>
        </label>
      </div>

      <!-- ===== GRILLE PRODUITS ===== -->
      <div class="grid" id="productGrid">

        <!-- Coco des iles -->
        <article
          class="p-card"
          data-index="1"
          data-price="40.00"
          data-rating="4.6"
          data-popularity="128"
          data-date="2025-01-15"
        >
          <a class="p-media" href="/produits/coco-des-iles" aria-label="Voir Coco des iles">
            <img src="/coco-des-iles1.png" alt="Coco des iles — Extrait de parfum" loading="lazy" />
          </a>
          <div class="p-body">
            <p class="p-eyebrow">VANILLEE</p>
            <h3 class="p-title"><a href="/produits/coco-des-iles">Coco des iles</a></h3>
            <div class="p-price">40,00</div>
            <a href="#" class="p-btn btn-buy" data-item="Coco des iles" data-price="40,00 €">JE VEUX ACHETER</a>
          </div>
        </article>

        <!-- Dragon rose (promo) -->
        <article
          class="p-card is-sale"
          data-index="2"
          data-price="35.00"
          data-rating="4.8"
          data-popularity="162"
          data-date="2025-02-06"
        >
          <a class="p-media" href="/produits/dragon-rose" aria-label="Voir Dragon rose">
            <img src="/dragon-rose2.png" alt="Dragon rose — Extrait de parfum" loading="lazy" />
            <span class="p-badge">PROMO</span>
          </a>
          <div class="p-body">
            <p class="p-eyebrow">FRUITEE</p>
            <h3 class="p-title"><a href="/produits/dragon-rose">Dragon rose</a></h3>
            <div class="p-price">
              <span class="old">40,00</span><span class="new">35,00</span>
            </div>
            <a href="#" class="p-btn btn-buy" data-item="Dragon rose" data-price="35,00 €">JE VEUX ACHETER</a>
          </div>
        </article>

        <!-- Musc fruite -->
        <article
          class="p-card"
          data-index="3"
          data-price="40.00"
          data-rating="4.4"
          data-popularity="97"
          data-date="2025-01-28"
        >
          <a class="p-media" href="/produits/musc-fruite" aria-label="Voir Musc fruite">
            <img src="/musc-fruite1.png" alt="Musc fruite — Extrait de parfum" loading="lazy" />
          </a>
          <div class="p-body">
            <p class="p-eyebrow">FRUITEE</p>
            <h3 class="p-title"><a href="/produits/musc-fruite">Musc fruite</a></h3>
            <div class="p-price">40,00</div>
            <a href="#" class="p-btn btn-buy" data-item="Musc fruite" data-price="40,00 €">JE VEUX ACHETER</a>
          </div>
        </article>

      </div>
    </div>
  </section>

  <!-- ===== STYLES ===== -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600;700;800;900&display=swap');

    :root{
      --ink:#243630;
      --muted:#6F6A65;
      --accent:#e8613c;
      --wrap: min(1240px, 94%);
    }

    /* Tout en Montserrat (page-scoped) */
    .hc, .hc *, .shop, .shop *{
      font-family:"Montserrat", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif !important;
    }

    /* ===== HERO ===== */
    .hc{ position:relative; width:100vw; max-width:100vw;
         margin-left:calc(50% - 50vw); margin-right:calc(50% - 50vw); overflow:clip; }
    .hc__media{ position:relative; width:100%; }
    .hc__bg{ display:block; width:100%; height:auto; }
    .hc__shade{ position:absolute; inset:0;
      background:radial-gradient(80% 60% at 50% 60%, rgba(0,0,0,.18), rgba(0,0,0,.28) 55%, rgba(0,0,0,.35));
      mix-blend-mode:multiply; pointer-events:none; }
    .hc__inner{ position:absolute; inset:0; display:grid; place-items:center; gap:18px; }
    .hc__blur-nav{
      --bg:rgba(255,255,255,.14); --bd:rgba(255,255,255,.28);
      display:inline-flex; gap:16px; flex-wrap:wrap; align-items:center;
      padding:10px 16px; border-radius:999px; background:var(--bg); border:1px solid var(--bd);
      color:#fff; backdrop-filter:blur(10px) saturate(120%); -webkit-backdrop-filter:blur(10px) saturate(120%);
      box-shadow:0 8px 30px rgba(0,0,0,.25); }
    .hc__blur-nav a{ color:#fff; text-decoration:none; font-weight:700; font-size:14px; opacity:.95; }
    .hc__blur-nav a:hover{ text-decoration:underline; opacity:1; }
    .hc__title{ margin:0; color:#fff; font-weight:900; font-size:clamp(32px,6vw,60px); text-shadow:0 2px 16px rgba(0,0,0,.45); }

    /* ===== SECTION BOUTIQUE ===== */
    .shop{ padding: 22px 0 60px; color:var(--ink); }
    .shop__wrap{ width:var(--wrap); margin:0 auto; }

    /* Toolbar (compteur + select) */
    .shop__toolbar{
      display:grid; grid-template-columns:1fr auto; gap:16px; align-items:end;
      margin:20px 0 22px;
    }
    .results-count{
      text-transform:uppercase; letter-spacing:.22em; font-weight:800; color:var(--ink); opacity:.95;
    }

    /* Select stylé */
    .sort select{
      appearance:none; -webkit-appearance:none; -moz-appearance:none;
      border:0; outline:0; background:transparent; padding:8px 28px 8px 0;
      border-bottom:2px solid var(--accent); font-weight:700; color:var(--ink); cursor:pointer;
      font-size:clamp(14px, 2vw, 18px);
      background-image:
        linear-gradient(45deg, transparent 50%, var(--ink) 50%),
        linear-gradient(135deg, var(--ink) 50%, transparent 50%);
      background-position:
        calc(100% - 14px) 55%,
        calc(100% - 8px) 55%;
      background-size:6px 6px, 6px 6px;
      background-repeat:no-repeat;
    }
    .sort select:focus{ outline:none; box-shadow:0 0 0 3px rgba(232,97,60,.15); border-bottom-color:var(--ink); }

    /* Grille produits */
    .grid{ display:grid; grid-template-columns:repeat(3, minmax(0,1fr)); gap:26px; }
    @media (max-width:980px){ .grid{ grid-template-columns:repeat(2, minmax(0,1fr)); } }
    @media (max-width:640px){ .grid{ grid-template-columns:1fr; } }

    .p-card{
      background:#faf7f2; border-radius:18px; overflow:hidden;
      box-shadow:inset 0 0 0 1px rgba(0,0,0,.06), 0 12px 28px rgba(0,0,0,.06);
    }
    .p-media{ position:relative; display:grid; place-items:center; aspect-ratio:4/3;
      background:#fff; border-bottom:1px solid rgba(0,0,0,.06); }
    .p-media img{ max-width:74%; max-height:80%; object-fit:contain; filter:drop-shadow(0 10px 16px rgba(0,0,0,.08)); }
    .p-badge{ position:absolute; right:12px; top:12px; background:var(--accent); color:#fff;
      padding:.35rem .55rem; border-radius:10px; font-size:.75rem; font-weight:800; letter-spacing:.06em; }
    .p-body{ padding:18px; text-align:center; }
    .p-eyebrow{ margin:0 0 6px; text-transform:uppercase; letter-spacing:.18em; font-weight:800; color:#2a3e36; opacity:.85; font-size:.9rem; }
    .p-title{ margin:4px 0 8px; font-weight:900; font-size:clamp(18px,2.1vw,26px); color:#184034; }
    .p-title a{ color:inherit; text-decoration:none; }
    .p-title a:hover{ text-decoration:underline; }

    /* Prix – € ajouté proprement */
    .p-price{ margin:6px 0 16px; color:#d65a38; font-weight:800; font-size:1.1rem; }
    .p-price, .p-price .old, .p-price .new{ font-variant-numeric: lining-nums; }
    .p-price::after{ content:none; }
    .p-price .old::after, .p-price .new::after{ content:"\00A0\20AC"; font-weight:800; }
    .p-price:not(:has(span))::after{ content:"\00A0\20AC"; font-weight:800; }
    .p-price .old{ color:#8a8a8a; text-decoration:line-through; margin-right:.4rem; font-weight:600; }
    .p-price .new{ color:#d65a38; font-weight:800; }

    .p-btn{
      display:inline-block; padding:14px 20px; border-radius:999px;
      background:var(--accent); color:#fff; text-decoration:none; font-weight:900;
      box-shadow:0 10px 24px rgba(232,97,60,.25);
    }
    .p-btn:hover{ filter:brightness(1.05); }
    .p-btn:active{ transform:translateY(1px); }

    /* ======== MOBILE-ONLY TWEAKS (≤ 640px) ======== */
    @media (max-width:640px){
      /* Évite tout débordement horizontal */
      body { overflow-x:hidden; }

      /* HERO : nav en “chips” scrollable, jamais coupée */
      .hc__inner{
        position:absolute; inset:0;
        display:flex; flex-direction:column; justify-content:flex-end; align-items:center;
        gap:12px; padding:18px 14px 22px;
      }
      .hc__blur-nav{
        width:100%;
        gap:10px;
        padding:8px 10px;
        border-radius:12px;
        overflow-x:auto;
        scrollbar-width:none;
        -ms-overflow-style:none;
        justify-content:flex-start;
        background:rgba(0,0,0,.25);
        border-color:rgba(255,255,255,.22);
        backdrop-filter:blur(8px) saturate(120%);
      }
      .hc__blur-nav::-webkit-scrollbar{ display:none; }
      .hc__blur-nav a{
        white-space:nowrap;
        font-size:13px;
        padding:8px 10px;
        border-radius:10px;
        background:rgba(255,255,255,.08);
      }
      .hc__title{
        font-size:34px;
        line-height:1.05;
        text-align:center;
        text-wrap:balance;
      }

      /* Toolbar empilée + select plein largeur */
      .shop__wrap{ width:min(720px, 92%); }
      .shop__toolbar{
        grid-template-columns:1fr;
        gap:10px;
        align-items:stretch;
        margin:16px 0 18px;
      }
      .results-count{ font-size:.78rem; letter-spacing:.18em; }
      .sort{ display:block; }
      .sort select{
        width:100%;
        padding:10px 34px 10px 0;
        font-size:15px;
      }

      /* Cartes : visuels un peu plus grands, titres lisibles */
      .p-media{ aspect-ratio:4/3; }
      .p-media img{ max-width:78%; }
      .p-body{ padding:16px 14px 18px; }
      .p-eyebrow{ font-size:.82rem; }
      .p-title{ font-size:20px; }
      .p-price{ font-size:1.05rem; margin-bottom:14px; }
      .p-btn{ display:block; width:100%; text-align:center; padding:13px 16px; }

      /* Grille : déjà 1 colonne via règle plus haut, on resserre l’écart */
      .grid{ gap:18px; }
    }

    /* Ultra-petit (≤ 360px) : micro-ajustements */
    @media (max-width:360px){
      .hc__title{ font-size:30px; }
      .hc__blur-nav a{ font-size:12px; padding:7px 8px; }
      .p-title{ font-size:19px; }
    }
  </style>

  <!-- ===== JS : compteur + tri + WhatsApp ===== -->
  <script>
    // Compteur
    (function(){
      const rc = document.querySelector('.results-count[data-first]');
      const grid = document.getElementById('productGrid');
      if(rc && grid){
        const total = grid.querySelectorAll('.p-card').length;
        const first = rc.dataset.first || 1;
        const last  = rc.dataset.last  || total;
        rc.textContent = `AFFICHAGE DE ${first}–${last} SUR ${total} RÉSULTATS`;
      }
    })();

    // Tri
    (function(){
      const grid = document.getElementById('productGrid');
      const select = document.getElementById('sortSelect');
      if(!grid || !select) return;

      function toNum(v){ return typeof v === 'string' ? parseFloat(v) : +v; }

      function sortProducts(mode){
        const items = Array.from(grid.children);
        const get = (el, attr) => el.getAttribute(attr);
        let sorted = items.slice();

        switch(mode){
          case 'pop':       sorted.sort((a,b)=> toNum(get(b,'data-popularity')) - toNum(get(a,'data-popularity')) ); break;
          case 'rating':    sorted.sort((a,b)=> toNum(get(b,'data-rating'))     - toNum(get(a,'data-rating')) );     break;
          case 'date':      sorted.sort((a,b)=> new Date(get(b,'data-date'))    - new Date(get(a,'data-date')) );    break;
          case 'price-asc': sorted.sort((a,b)=> toNum(get(a,'data-price'))      - toNum(get(b,'data-price')) );      break;
          case 'price-desc':sorted.sort((a,b)=> toNum(get(b,'data-price'))      - toNum(get(a,'data-price')) );      break;
          default:          sorted.sort((a,b)=> toNum(get(a,'data-index'))      - toNum(get(b,'data-index')) );
        }

        const frag = document.createDocumentFragment();
        sorted.forEach(el => frag.appendChild(el));
        grid.appendChild(frag);
      }

      select.addEventListener('change', e => sortProducts(e.target.value));
    })();

    // WhatsApp "JE VEUX ACHETER"
    (function(){
      const PHONE = "33650959363";
      document.addEventListener('click', (e)=>{
        const btn = e.target.closest('.btn-buy');
        if(!btn) return;
        e.preventDefault();
        const item  = btn.dataset.item  || 'un produit';
        const price = btn.dataset.price || '';
        const msg = `Bonjour, je veux acheter ${item}${price ? ' ('+price+')' : ''}.`;
        const url = `https://wa.me/${PHONE}?text=${encodeURIComponent(msg)}`;
        window.open(url, '_blank', 'noopener');
      });
    })();
  </script>
</Layout>
